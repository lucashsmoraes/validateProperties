name: Create Checklist Issue on Push

on:
  push:
    branches:
      - feature/*

jobs:
  create-issue:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Set up GitHub CLI
        run: |
          sudo apt-key adv --keyserver keyserver.ubuntu.com --recv-key C99B11DEB97541F0
          echo "deb [arch=amd64] https://cli.github.com/packages stable main" | sudo tee /etc/apt/sources.list.d/github-cli.list
          sudo apt update
          sudo apt install gh -y

      - name: Authenticate GitHub CLI
        run: echo ${{ secrets.GH_TOKEN }} | gh auth login --with-token

      - name: Read Checklist Template
        id: read-template
        run: |
          CHECKLIST=$(cat .github/ISSUE_TEMPLATE/checklist.md)
          echo "CHECKLIST<<EOF" >> $GITHUB_ENV
          echo "$CHECKLIST" >> $GITHUB_ENV
          echo "EOF" >> $GITHUB_ENV

      - name: Create Issue
        run: gh issue create --title "Code Review Checklist" --body "$CHECKLIST" --label "checklist"
        env:
          CHECKLIST: ${{ env.CHECKLIST }}
